<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Deep Learning on Google Cloud Platform Using Python</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we saw a variety of deep learning APIs that are provided by various organizations. We also saw their applicability broadly grouped into two categories—the first was computer vision and image processing, and the second was natural language processing. We are going to continue exploring deep learning APIs in this chapter as well. This chapter introduces you to <strong>Google Cloud Platform</strong> (<strong>GCP</strong>) and three APIs offered by it in the area of deep learning.</p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li style="font-weight: 400;">Setting up your GCP account</li>
<li style="font-weight: 400;">Creating your first project on GCP</li>
<li style="font-weight: 400;">Using the Dialogflow API in Python</li>
<li style="font-weight: 400;">Using the Cloud Vision API in Python</li>
<li style="font-weight: 400;">Using the Cloud Translation API in Python</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>You can access the code for this chapter from <a href="https://github.com/PacktPublishing/Hands-On-Python-Deep-Learning-for-Web/tree/master/Chapter6">https://github.com/PacktPublishing/Hands-On-Python-Deep-Learning-for-Web/tree/master/Chapter6</a>.</p>
<p>To run the code in this chapter, you'll need to have Python 3.6+ on your system.</p>
<p>Other requisite installations will be introduced during the course of this chapter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up your GCP account</h1>
                </header>
            
            <article>
                
<p>Before we proceed with using the APIs offered by GCP, you must set up your GCP account. Assuming that you already have a Google account—first, head to <a href="https://cloud.google.com/">https://cloud.google.com/</a>. GCP gives you $300 of credit (which you can use for a period of 12 months) if you are signing up to it for the first time; this credit is sufficient enough to accommodate many good projects and enable you to try out the offerings of GCP. Once this has been done, we can follow these steps:</p>
<ol>
<li>At the top-right corner of GCP's home page, you should be able to locate a <span class="packt_screen">Try free</span> button. <span>Just click on it</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1306 image-border" src="assets/8d0065fb-e97a-457a-bca4-8a70e70fa661.png" style="width:23.83em;height:5.17em;"/></p>
<ol start="2">
<li>If you are not signed in to your Google account, you will be asked to sign in. <span>Select your country accordingly and make sure you check the <span class="packt_screen">Terms of service</span> box. After this, click on <span class="packt_screen">AGREE AND CONTINUE</span>. Y</span>ou will see a page as in the following screenshot:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1307 image-border" src="assets/c2b7f7a6-bbb5-4daf-8a80-e52ef7edd315.png" style="width:31.33em;height:22.25em;"/></p>
<ol start="3">
<li>Then, you will be asked to enter the details for a payment method of your choice. Even if you have free credits, in order to use GCP's utilities, you need to set up a valid billing account. But don't worry, you will not be charged from your billing account unless you allow GCP to do so. During your free trial, all the billable utilities that you will use on GCP will be deducted from your free credit only. Once the limit for your free credit ends, GCP will send you a reminder.</li>
</ol>
<p>Once your billing formalities are done, you should end up at GCP's console page, which looks like this:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1308 image-border" src="assets/469c0188-c363-4a28-a15f-d060ca342a01.png" style="width:60.00em;height:32.25em;"/></p>
<p>This is actually your GCP dashboard, which gives you an overall summary of your GCP usage. GCP also lets you customize the tags that appear on your GCP console.</p>
<p>You should now be done with the GCP account setup. To be able to use the utilities in GCP, you need to create a GCP project with a valid billing account tagged to it. In the next section, you will see how to do that.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating your first project on GCP</h1>
                </header>
            
            <article>
                
<p>A project helps you organize all your GCP resources systematically. Creating a project on GCP can be done in just a matter of a few clicks:</p>
<ol>
<li>After signing in to your Google account, open up your GCP console using <a href="https://console.cloud.google.com">https://console.cloud.google.com</a>. In the top-left corner, you should see <span class="packt_screen">Google Cloud Platform</span> and just beside that, you can see a drop-down list, as shown:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1309 image-border" src="assets/97baa6ef-0c5a-4258-b4d2-f1910f97cc82.png" style="width:31.33em;height:3.08em;"/></p>
<ol start="2">
<li>If you did create any projects while signing up for GCP or previously, then one of your projects will appear in the marked area (<span class="packt_screen">fast-ai-exploration</span> and <span class="packt_screen">gcp-api</span> are two projects that I created on GCP). Now, click on the down arrow and a popup should appear:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1310 image-border" src="assets/d3f3ccc7-fc1e-4338-9fb3-f5704b19b0f7.png" style="width:39.00em;height:21.25em;"/></p>
<ol start="3">
<li>Click on <span class="packt_screen">NEW PROJECT</span> to proceed. You should end up on a page, shown in the following screenshot, that will ask you to specify the project's name. GCP automatically generates an ID for the project that you are creating but it also lets you edit that ID according to your choices:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1311 image-border" src="assets/d1652d62-c16c-4b05-b638-cbbaaebcb4b0.png" style="width:34.00em;height:22.42em;"/></p>
<ol start="4">
<li>After you are done specifying the initial details of your project, just click on <span class="packt_screen">CREATE</span> and the project will be created. Once the project is created, it should appear in the projects list. You can always navigate to this list using the handy dropdown that GCP provides on its console page. You can see this i<span>n the following screenshot</span>:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1312 image-border" src="assets/eec5591a-a3f9-4e1a-b6aa-bbe3b0be234a.png" style="width:38.08em;height:17.50em;"/></p>
<p>If you want to learn more about GCP projects, you can check the official documentation at <a href="https://cloud.google.com/storage/docs/projects">https://cloud.google.com/storage/docs/projects</a>. GCP is equipped with a wide suite of various utilities that can be found at <a href="https://cloud.google.com/products/">https://cloud.google.com/products/</a>. You are encouraged to take a look and explore them with respect to your interests.</p>
<p>GCP provides us with a wide range of APIs that can be used for a variety of tasks, including deep learning. In the next couple of sections, we will see how some of the most widely used deep learning APIs can be consumed using Python code. We will start with Dialogflow.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the Dialogflow API in Python</h1>
                </header>
            
            <article>
                
<p>Before we start to learn how to use the Dialogflow API in Python, let's understand what Dialogflow is all about.</p>
<p>Dialogflow (formerly known as <strong>api.ai</strong>) provides a suite of utilities for building natural and rich conversational interfaces, such as voice assistants and chatbots. It is powered by deep learning and natural language processing and is used by a large number of companies. It seamlessly integrates with websites, mobile applications, and many popular platforms, such as Facebook Messenger, Amazon Alexa, and so on. Dialogflow provides us with three major components for building a conversational user interface:</p>
<ul>
<li style="font-weight: 400;">The best practices and processes that can easily be applied to any conversational user interface</li>
<li style="font-weight: 400;">Functionalities to add any custom logic that might be required for building a conversational user interface</li>
<li style="font-weight: 400;">Facilities to train agents so as to fine-tune the overall experience of the interface</li>
</ul>
<p>Now, we will see how Dialogflow can be used to create a simple application in Python. You can refer to <a href="https://dialogflow.com">https://dialogflow.com</a> to learn more about Dialogflow.</p>
<p>We will begin with the creation of a Dialogflow account.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a Dialogflow account</h1>
                </header>
            
            <article>
                
<p>Creating a Dialogflow account is simple and easy. The process involves the following steps:</p>
<ol>
<li>Visit <a href="https://console.dialogflow.com/api-client/#/login">https://console.dialogflow.com/api-client/#/login</a> and you will see the following screen:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1474 image-border" src="assets/397707d9-086c-4cdf-902b-4ec2d5944ec1.png" style="width:31.42em;height:10.42em;"/></p>
<ol start="2">
<li>After clicking the sign in with <span class="packt_screen">Google</span> button, you'll be asked to choose which Google account you want to use with Dialogflow.</li>
<li>On selecting the account, you might be asked to allow <span class="packt_screen">Account Permissions</span> for Diagflow and also to accept the Dialogflow terms and conditions.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a new agent</h1>
                </header>
            
            <article>
                
<p>After creating an account, you will be greeted with a dashboard that will either display your active Dialogflow projects or ask you to create a new agent to be displayed—but what is an <strong>agent</strong>?</p>
<p>An agent—in Dialogflow terminology—is a piece of software that performs the task of receiving input from users, which might be in the format of text, audio, image, or video. It then tries to determine the <em>intent</em> or the previously defined appropriate action corresponding to the input. The matched intent might perform an <em>action</em> or it may simply arrive on a hypertext response to the query made by the user input. Finally, the agent returns the results to the user.</p>
<p>To create a new agent, in the left-hand side navigation menu of the Dialogflow console, click on <span class="packt_screen">Create Agent</span>.</p>
<p>You will be presented with a screen that looks like this:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1314 image-border" src="assets/9023d9b6-88bb-447f-aeb6-17b44aae03b8.png" style="width:42.42em;height:13.00em;"/></p>
<p>We have named our agent <span class="packt_screen">DemoBot</span> and set the default language to <span class="packt_screen">English</span>. Further, we had to select a Google project for the agent.</p>
<p>A Google project—or simply a <strong>project</strong>—is a term that you encounter in the study of GCP. A project encompasses the entire array of resources allocated toward any software project that uses those resources and is financed by a single billing account on GCP. No resources can be allocated without defining a project for them. Further, no project can be created without adding a valid billing option to it.</p>
<p>You will now be able to see a screen, as in the following screenshot, with certain default intents provided for your agent:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1315 image-border" src="assets/768479fc-f213-41d9-898d-927c60d1869b.png" style="width:50.08em;height:30.50em;"/></p>
<p>On the left, you can see the navigation menu, which provides all the various modules that can be brought together in your agent for better human-like interaction provided by the software. In the right-hand side panel, you have the option to test your agent at any moment with any input you provide. This will come in handy during the development of responses and when testing the matching of intents with input provided.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a new intent</h1>
                </header>
            
            <article>
                
<p>To create a new intent for our agent, follow these steps:</p>
<ol>
<li>Click the <span class="packt_screen">Create Intent</span> button at the top-right corner of the middle section.</li>
<li>You need to provide a name for this intent—let's say <kbd>Dummy Intent</kbd>.</li>
<li>We will then need to provide some training phrases that would trigger this intent. Let's say we provide three training phrases, as shown:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1316 image-border" src="assets/a4a2458f-1671-4689-b374-e77d590feef0.png" style="width:22.42em;height:15.42em;"/></p>
<p style="padding-left: 60px;">Now, we can expect this intent to be called on whenever the system encounters the phrases (or similar phrases) mentioned in the training.</p>
<ol start="4">
<li>We can now add some responses that our agent will make when this intent is invoked, as shown:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1475 image-border" src="assets/384b2f86-2a4f-40e0-8d34-b77951aa764d.png" style="width:21.33em;height:18.58em;"/></p>
<ol start="5">
<li>At the top-right corner of the middle section, click on the <span class="packt_screen">SAVE</span> button to save the new intent and you will be notified that the agent training has started.</li>
</ol>
<p>For a small agent, the training completes within seconds and you'll be presented with an <span class="packt_screen">Agent training completed</span> notification.</p>
<p>We are now ready to test whether our agent is able to execute this intent.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Testing your agent</h1>
                </header>
            
            <article>
                
<p>On the right-hand side section of your Dialogflow console, you'll be able to test your agent. In the top text field, enter your query. In our agent, to call <kbd>Dummy Intent</kbd>, we'll write <kbd>Talk to the dummy</kbd>.</p>
<p>If the intent matches <span>correctly</span><span>, you'll be able to see the response from <kbd>Dummy Intent</kbd></span><span>, as shown:</span></p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1476 image-border" src="assets/9846d629-256f-4200-a012-02f6dba24730.png" style="width:18.50em;height:30.33em;"/></p>
<p>In the previous screenshot, you will observe that the input of the user is <kbd>Talk to the dummy</kbd> and the response generated is one of the two responses we defined in the responses for <kbd>Dummy Intent</kbd>. You can observe that the intent that was matched to the input was <kbd>Dummy Intent</kbd>.</p>
<p>We will now look at how we can invoke the agent using Python.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing the Dialogflow Python SDK</h1>
                </header>
            
            <article>
                
<p>In this section, we will demonstrate how you can use the Dialogflow Python API V2 with your Dialogflow agent to bring interactivity to your application built using Python. Let's first understand how the several components of the DialogFlow ecosystem interact with the following diagram:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1319 image-border" src="assets/48741d83-0b89-4933-a7f4-df36291f5f9a.png" style="width:60.92em;height:34.75em;"/></p>
<p class="mce-root">The user creates the input, which is sent to the agent via integration APIs, websites, or apps. The agent matches the user input to the available intents and produces a fulfillment of the <strong>query</strong>. The response is sent back to the user interface by the means of a webhook and the response is presented to the user.</p>
<p>It is quite possible for the integration APIs to include services other than Dialogflow. You could create an application that could propagate the same user query to multiple agents and consolidate their response.</p>
<p>Alternatively, the developer can introduce middleware handlers or integrations, which would preprocess or postprocess the user query and agent response:</p>
<ol>
<li>To install the Dialogflow Python SDK, we use the following command in the terminal:</li>
</ol>
<pre style="padding-left: 60px;"><strong>pip install dialogflow</strong></pre>
<div class="packt_tip">It is highly recommended that you create a virtual environment using <kbd>virtualenv</kbd> before using the previous command to have clean and unbroken dependencies. To learn more about <kbd>virtualenv</kbd>, refer to <a href="https://virtualenv.pypa.io/en/latest/">https://virtualenv.pypa.io/en/latest/</a>.</div>
<ol start="2">
<li>After the installation is complete, you will be able to import the Dialogflow API to your project by using the following import code:</li>
</ol>
<pre style="padding-left: 60px;">import dialogflow</pre>
<p>We'll now create a GCP service account to authenticate our Python script in order to use the Dialogflow agent we created.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a GCP service account</h1>
                </header>
            
            <article>
                
<p>A GCP service account manages the permissions provided to access a GCP resource. The Dialogflow agent we created was a GCP resource and so to use it from the Python API, we'll need a service account:</p>
<ol>
<li>In the GCP console, from the left-hand side navigation menu, go to <span class="packt_screen">APIs</span> | <span class="packt_screen">Services</span> | <span class="packt_screen">Credentials</span>.</li>
<li>Click the <span class="packt_screen">Create credentials</span> button to get the following options:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1320 image-border" src="assets/6bbe0df1-e132-459f-bc1b-f48cfb9be413.png" style="width:28.67em;height:22.17em;"/></p>
<ol start="3">
<li>Click on <span class="packt_screen">Service account key</span>. In the page that comes up next, select <span class="packt_screen">Dialogflow Integrations</span> as the service account and <span class="packt_screen">JSON</span> as the key type. After clicking <span class="packt_screen">Create</span>, a JSON file is downloaded to your computer.</li>
<li>Note down the address of this JSON file—for example, <kbd>/home/user/Downloads/service-account-file.json</kbd>. The file name could differ, as it is provided by the GCP console when you download the file to your computer.</li>
<li>Open this file to obtain the project ID.</li>
<li>Now, use the following commands—with suitable replacements as present on your system—in the terminal to export the credentials to the environment variables:</li>
</ol>
<ul>
<li style="list-style-type: none;">
<ul>
<li>In Linux (Terminal):</li>
</ul>
</li>
</ul>
<pre class="devsite-code-button-clone"><strong><span class="pln">export GOOGLE_APPLICATION_CREDENTIALS</span><span class="pun">=</span></strong><span class="str"><strong>"&lt;your_service_account_file_location&gt;"</strong><br/><strong>export DIALOGFLOW_PROJECT_ID="&lt;your_project_id&gt;"</strong><br/></span></pre>
<ul>
<li style="list-style-type: none;">
<ul>
<li>In Windows (Command Prompt):</li>
</ul>
</li>
</ul>
<pre class="devsite-code-button-clone"><strong><span class="kwd">set</span><span class="pln"> GOOGLE_APPLICATION_CREDENTIALS</span></strong><span class="pun"><strong>=&lt;your_service_account_file_location&gt;</strong><br/><strong>set DIALOGFLOW_PROJECT_ID=&lt;your_project_id&gt;</strong><br/></span></pre>
<p>With this done, we are now ready to write the Python script that will call our Dialogflow agent.</p>
<div class="packt_infobox">Please note that the preceding commands only set the variables for the current session. You need to run the commands every time you restart the session.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Calling the Dialogflow agent using Python API</h1>
                </header>
            
            <article>
                
<p>In this example, we'll be creating a simple Python-based API that calls to the agent we created in the Dialogflow console to invoke <kbd>Dummy Intent</kbd>, as shown:</p>
<ol>
<li>Firstly, we must import the Dialogflow module to the project. To do so, use the following code:</li>
</ol>
<pre style="padding-left: 60px;">import dialogflow</pre>
<ol start="2">
<li>To get the project ID into the script, we can fetch it from the runtime environment variables. To do so, use the following code:</li>
</ol>
<pre style="padding-left: 60px;">import os<br/>project_id = os.getenv("DIALOGFLOW_PROJECT_ID")</pre>
<ol start="3">
<li>We will also declare a unique session ID to store the records of the conversations made in any single session with the user:</li>
</ol>
<pre style="padding-left: 60px;">session_id="any_random_unique_string"</pre>
<ol start="4">
<li>We'll now create a handy function that will allow us to repeatedly perform a set of preprocessing statements required to call the Dialogflow agent:</li>
</ol>
<pre style="padding-left: 60px;">def detect_intent(project_id, session_id, text, language_code):<br/><br/>    session_client = dialogflow.SessionsClient()<br/>    session = session_client.session_path(project_id, session_id)<br/>    <br/>    text_input = dialogflow.types.TextInput(text=text, language_code=language_code)<br/>    query_input = dialogflow.types.QueryInput(text=text_input)<br/>    response = session_client.detect_intent(session=session, query_input=query_input)<br/>    <br/>    return response.query_result.fulfillment_text</pre>
<p style="padding-left: 60px;">In the preceding code, we will first initialize a <kbd>SessionsClient</kbd> object. A session records the complete interaction between the user and the Dialogflow agent during one uninterrupted conversation. Next, we must set the path of the session, which is the mapping of the project to a unique session ID.</p>
<p style="padding-left: 60px;">The next two lines of the preceding function definition are used to create a Dialogflow <kbd>QueryInput</kbd> object that contains a Dialogflow <kbd>TextInput</kbd> object. The <kbd>query_input</kbd> variable holds the message the user inputs for the Dialogflow agent.</p>
<p style="padding-left: 60px;">The next line invokes the <kbd>detect_intent()</kbd> method of the <kbd>SessionsClient</kbd> object. The <kbd>session ID-project ID</kbd> mapping, along with the input, is passed as the parameter to the method. The response of the Dialogflow agent is stored in the response variable. The function returns the fulfillment text response.</p>
<ol start="5">
<li>Let's now use this method. First, declare a message to pass to the Dialogflow agent. Recall the training phrases we provided to our Dialogflow agent for <kbd>Dummy Intent</kbd>. We'll pass a message that is similar to the training phrases:</li>
</ol>
<pre style="padding-left: 60px;">message = "Can I talk to the dummy?"<br/><br/>fulfillment_text = detect_intent(project_id, session_id, message, 'en')<br/><br/>print(fulfillment_text)</pre>
<p style="padding-left: 60px;">We will get an output that is among the two responses we defined for <kbd>Dummy Intent</kbd>.</p>
<ol start="6">
<li>Generate the response variable in the <kbd>detect_intent()</kbd> method, which can be done by adding the following line of code in the <kbd>detect_intent()</kbd> function:</li>
</ol>
<pre style="padding-left: 60px;">def detect_intent(project_id, session_id, text, language_code):<br/>    ...<br/>    response = session_client.detect_intent(session=session, query_input=query_input)<br/>    print(response) ### &lt;--- ADD THIS LINE<br/>    <br/>    return response.query_result.fulfillment_text</pre>
<p style="padding-left: 60px;">You will get the following JSON:</p>
<pre style="padding-left: 60px;">response_id: "d1a7b2bf-0000-0000-0000-81161394cc24"
query_result {
  query_text: "talk to the dummy?"
  parameters {
  }
  all_required_params_present: true
  fulfillment_text: "Congratulations, dummy intent user!"
  fulfillment_messages {
    text {
      text: "Congratulations, dummy intent user!"
    }
  }
  intent {
    name: "projects/gcp-api-232806/agent/intents/35e15aa5-0000-0000-0000-672d46bcefa7"
    display_name: "Dummy Intent"
  }
  intent_detection_confidence: 0.8199999928474426
  language_code: "en"
}</pre>
<p>You will observe that the name of the matched intent is <kbd>Dummy Intent</kbd> and the output that we had in this call of the agent is <kbd>Congratulations, dummy intent user!</kbd>.</p>
<p>There are several other ways of using the Dialogflow API using Python, including—but not limited to—audio-visual input and sensor-based inputs. The Dialogflow agents can be integrated with major platforms, such as Google Assistant, Facebook Messenger, Slack, Telegram, WhatsApp, and several others, as shown:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1321 image-border" src="assets/1d530c5f-6145-41e3-8de2-e80c9a4b511e.png" style="width:30.83em;height:26.58em;"/></p>
<p>The Dialogflow ecosystem is rapidly introducing new features and is increasingly moving toward providing complete AI-based chatbots that can perform several tasks at the same time.</p>
<p>In the next section, we'll explore another GCP API that can be used to predict the contents of images and videos.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the Cloud Vision API in Python</h1>
                </header>
            
            <article>
                
<p>Computer vision is the field of making computers understand images and make sense of them. Common computer vision tasks include image classification, image detection, image segmentation, and so on. As discussed in earlier chapters, the field of computer vision has been heavily affected by the effectiveness of deep learning in achieving human-level (and sometimes even better) <span>performance</span><span>.</span></p>
<p>The Cloud Vision API provides us with a lot of utilities for performing computer vision tasks. Cloud Vision allows us to use the pre-trained models as well as build our own custom production-ready models that cater to our needs (such as AutoML Vision Beta). Let's now briefly look at the features that are offered by the Cloud Vision API:</p>
<ul>
<li style="font-weight: 400;">Label detection</li>
<li style="font-weight: 400;">Optical character recognition</li>
<li style="font-weight: 400;">Handwriting recognition</li>
<li style="font-weight: 400;">Landmark detection</li>
<li style="font-weight: 400;">Object localization</li>
<li style="font-weight: 400;">Image search</li>
<li style="font-weight: 400;">Product search</li>
</ul>
<p>Apart from the previously mentioned features, Cloud Vision also lets us extract different attributes of a given image. The following screenshot shows this utility:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1322 image-border" src="assets/278c72a8-1139-4273-a4e3-2d4f2274343d.png" style="width:38.50em;height:17.75em;"/></p>
<p class="mce-root"/>
<p>As we can see, when given an image, the Cloud Vision API automatically extracts its attributes. You can also try this by going to <a href="https://cloud.google.com/vision/">https://cloud.google.com/vision/</a>.</p>
<p>We have been using the term <strong>pre-trained models</strong> from earlier chapters. We have also seen how the Cloud Vision API lets us incorporate the pre-trained models. It will be worth digging a bit deeper into the term pre-trained models in order to understand the importance of using them.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The importance of using pre-trained models</h1>
                </header>
            
            <article>
                
<p>The use of pre-trained models is commonly referred to as <strong>transfer learning</strong>. Transfer learning is not something that is very fundamental to deep learning and it is just a methodology. It doesn't denote a particular deep learning model but its implications of transfer learning are very effective, especially in a deep learning context.</p>
<p>We human beings do not learn each and every task from scratch; we try to utilize our past experiences to do tasks that are similar in nature. This is transfer learning. We tend to transfer the knowledge of our past experiences to similar tasks that we are met with.</p>
<p>But how is this applicable to deep learning? Let's find out.</p>
<p>When a neural network is trained for a particular task, it tries to estimate the value of the best possible weight's matrices. Now, when you attempt to train another network on a similar kind of task, it turns out that you can use the weights from the previous task. The definition "similarity" is broad here and can be avoided for the time being. But you may wonder what the advantage here is. Well, the advantages are manifold, but here are a couple of examples:</p>
<ul>
<li style="font-weight: 400;">You don't need to train your neural network from scratch, which saves you a lot of time.</li>
<li style="font-weight: 400;">It leverages the opportunity to use state-of-the-art results from a problem domain that is similar to yours.</li>
</ul>
<p>In literature, the task that you use the network weights from is called a source task and the task that you apply the weights to is called the target task. The network model that you use the weights from is referred to as the pre-trained model. Goodfellow et al. gave a very subtle definition of transfer learning in their book <em>Deep Learning</em>:</p>
<div class="packt_quote">"[A] situation where what has been learned in one setting is exploited to improve generalization in another setting."</div>
<p>The use of transfer learning has shown exceptional results in a wide range of deep learning applications in areas such as <strong>Natural Language Processing</strong> (<strong>NLP</strong>), computer vision, and more. But transfer learning has its limitations as well:</p>
<ul>
<li style="font-weight: 400;">Transfer learning can result in a performance drop when the source task is not sufficiently related to the task where transfer learning is being used.</li>
<li style="font-weight: 400;">It gets difficult sometimes to determine how much transfer is required from the source task to the target task.</li>
</ul>
<p>For an in-depth study of transfer learning, you are encouraged to go through the book <em>Hands-On Transfer Learning with Python</em> by Dipanjan et al<em>.</em> We will now learn—with the help of an example—how to use the Cloud Vision API using Python.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up the Vision Client libraries</h1>
                </header>
            
            <article>
                
<p>The Cloud Vision API is available through a set of libraries for different languages, called the Vision Client libraries.</p>
<p>One such library offered in this set is the Python Cloud Vision Client library, which we will be using in our example:</p>
<ol>
<li>To install the Python Cloud Vision Client library, we use the following command in the terminal:</li>
</ol>
<pre style="padding-left: 60px;"><strong>pip install --upgrade google-cloud-vision</strong></pre>
<div class="packt_tip">It is highly recommended that you use a Python virtual environment to install the Vision Client library.</div>
<ol start="2">
<li>After the installation is complete, we will need to set up a service account to use the API.</li>
</ol>
<ol start="3">
<li>As d<span>iscussed previously, the steps to be followed for setting up a service account are as follows</span><span>:</span>
<ol>
<li>Open the Google Cloud console.</li>
<li>Go to <span class="packt_screen">APIs</span> | <span class="packt_screen">Services</span> | <span class="packt_screen">Credentials<span>.</span></span></li>
<li>Click on <span class="packt_screen">Create credentials<span>.</span></span></li>
<li>Choose <span class="packt_screen">New Service Account</span> in the drop-down menu for selecting the service account.</li>
<li>Fill in any name for the service account.</li>
<li>Leave <span class="packt_screen">Role</span> unchecked. This is not needed when using the Cloud Vision API.</li>
<li>Click on <span class="packt_screen">Create</span>. Confirm any warning boxes that appear.</li>
<li>The <kbd>service account credentials</kbd> JSON file gets downloaded to your computer.</li>
</ol>
</li>
</ol>
<ol start="4">
<li>Now, as we did previously, export this downloaded file to the system environment. To do this, use the following command:</li>
</ol>
<ul>
<li style="list-style-type: none;">
<ul>
<li>In Linux (Terminal):</li>
</ul>
</li>
</ul>
<pre style="padding-left: 60px;" class="devsite-code-button-clone"><strong><span class="pln">export GOOGLE_APPLICATION_CREDENTIALS</span><span class="pun">=</span></strong><span class="str"><strong>"/home/user/Downloads/service-account-file.json"</strong><br/></span></pre>
<ul>
<li style="list-style-type: none;">
<ul>
<li class="devsite-code-button-clone">In Windows (Command Prompt):</li>
</ul>
</li>
</ul>
<pre style="padding-left: 60px;" class="devsite-code-button-clone"><strong><span class="kwd">set</span><span class="pln"> GOOGLE_APPLICATION_CREDENTIALS</span><span class="pun">=/home/user/Downloads/service-account-file.json</span></strong></pre>
<ol start="5">
<li>As a final step before using the Cloud Vision API, we need to enable the API within the project that we created the service account for. To do so, do the following:
<ol>
<li>In the Google Cloud console's left-hand side navigation panel, click on <span class="packt_screen">APIs and Services</span>.</li>
<li>Click on <span class="packt_screen">Enable APIs &amp; Services<span>.</span></span></li>
<li>Find the Cloud Vision API in the list that appears.</li>
<li>Click on <span class="packt_screen">Enable<span>.</span></span></li>
</ol>
</li>
</ol>
<p>After this, we are ready to use the Cloud Vision API using Python in our script.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Cloud Vision API calling using Python</h1>
                </header>
            
            <article>
                
<p>Let's create a new Python script (or Jupyter notebook). In order to use the Cloud Vision API, we first need to import the Cloud Vision Client library.</p>
<ol>
<li>To do this, we use the following code:</li>
</ol>
<pre style="padding-left: 60px;">from google.cloud import vision</pre>
<ol start="2">
<li>With this, we're ready to move on and use the client library. In our example, we will annotate an image. The image annotation service is provided by the <kbd>imageAnnotatorClient()</kbd> function in the Vision library. We will create an object of the method:</li>
</ol>
<pre style="padding-left: 60px;">client = vision.ImageAnnotatorClient()</pre>
<ol start="3">
<li>Now, let's load the file to be tested for annotation into the program:</li>
</ol>
<pre style="padding-left: 60px;">with open("test.jpg", 'rb') as image_file:<br/>    content = image_file.read()</pre>
<div class="packt_infobox">Note that you should have the <kbd>test.jpg</kbd> file in the same working directory in order for this to work.</div>
<ol start="4">
<li>The file is currently a raw binary data file for the program. For the Cloud Vision API to work, we need to convert this into a type of image that the Vision Client will accept:</li>
</ol>
<pre style="padding-left: 60px;">image = vision.types.Image(content=content)</pre>
<ol start="5">
<li>Finally, we make the call for GCP to annotate the image via the Cloud Vision API:</li>
</ol>
<pre style="padding-left: 60px;">response = client.label_detection(image=image)<br/>labels = response.label_annotations</pre>
<p>After printing the labels set by the vision API, we will be able to see all the possible objects and features that the Cloud Vision API is able to detect in the picture provided, as shown:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1477 image-border" src="assets/20979113-d6cc-4b94-be0e-1fc2f49ba1c0.png" style="width:38.50em;height:18.25em;"/></p>
<p>If you print <kbd>labels</kbd>, the result should look like this:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1324 image-border" src="assets/fccb87ea-584c-4f34-8559-40f1e95c5206.png" style="width:20.42em;height:20.42em;"/></p>
<p>The predicted labels are <kbd>Sky</kbd>, <kbd>Horizon</kbd>, <kbd>Atmosphere</kbd>, <kbd>Sunrise</kbd>, <kbd>Sunset</kbd>, <kbd>Morning</kbd>, <kbd>Ocean</kbd>, <kbd>Calm</kbd>, <kbd>Wing</kbd>, and <kbd>Evening</kbd>.</p>
<p>The preceding predictions are very close to the real scene that is captured in the preceding photo. It was sunrise and taken from the window of an airplane.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the Cloud Translation API in Python</h1>
                </header>
            
            <article>
                
<p>The Cloud Translation API helps developers to easily integrate language translation functionalities into their applications. It is powered by state-of-the-art neural machine translation, which can be thought of as an amalgamation of deep learning and machine translation. The Cloud Translation API provides programmatic interfaces for using pre-trained models and building production-ready custom models.</p>
<p>Many developers use the Cloud Translation API's pre-trained models to dynamically translate a given set of text into a target language. The Cloud Translate API supports more than 100 languages. But this language library is evolving to empower the developer community. The following screenshot shows a translation of some text written in English to Bengali:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-1325 image-border" src="assets/eb0bdcce-a7ea-47a3-bd8f-4f49cb6251a6.png" style="width:29.58em;height:7.50em;"/></p>
<p>You can always try this on <a href="https://cloud.google.com/translate/">https://cloud.google.com/translate/</a>. But sometimes, the language of a given text might be unknown itself. The Cloud Translation API provides a service called <strong>label detection</strong> to handle situations like this.</p>
<p>The AutoML variant of the Cloud Translation API lets us build custom models with respect to language pairs (the source language and target language) according to our needs.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up the Cloud Translate API for Python</h1>
                </header>
            
            <article>
                
<p>To use the Cloud Translation API with Python, we must first install the Google Cloud Translate Python library.</p>
<ol>
<li>To do so, use the following <kbd>pip</kbd> command in the terminal:</li>
</ol>
<pre style="padding-left: 60px;"><strong>pip install google-cloud-translate</strong></pre>
<ol start="2">
<li>Now, as done previously, create a service account and download the credentials file. Export this file to the path for the <kbd>GOOGLE_APPLICATION_CREDENTIALS</kbd> environment variable.</li>
<li>Next, find <kbd>Cloud Translate API</kbd> in the list of APIs to enable. Once done, we're ready to make translations directly from Python using GCP.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the Google Cloud Translation Python library</h1>
                </header>
            
            <article>
                
<p>Create a new Jupyter notebook or a new Python script. We will now import the Google Cloud Translate API to our project.</p>
<ol>
<li>To do so, use the following code:</li>
</ol>
<pre style="padding-left: 60px;">from google.cloud import translate_v2 as translate</pre>
<ol start="2">
<li>We would need to create a Cloud Translate API object to make the service calls. We can do so as follows:</li>
</ol>
<pre style="padding-left: 60px;">translate_client = translate.Client()</pre>
<ol start="3">
<li>Let's now begin with the translation process. First, we need a message to translate:</li>
</ol>
<pre style="padding-left: 60px;">original = u'नमस्ते'</pre>
<p style="padding-left: 60px;">This creates a Unicode string containing the word <em>Namaste</em> in Hindi. Let's see what it converts to in English!</p>
<p style="padding-left: 60px;">We call the API to translate the text into English using the following code:</p>
<pre style="padding-left: 60px;">translation = translate_client.translate(original, target_language="en")</pre>
<p style="padding-left: 60px;">If you observe the <kbd>translation</kbd> variable, you will find that it contains the following details:</p>
<pre style="padding-left: 60px;">{<br/>    'translatedText': 'Hello', <br/>    'detectedSourceLanguage': 'hi', <br/>    'input': 'नमस्ते'<br/>}</pre>
<p>It is simple to infer from this dictionary that the detected language was Hindi (represented by <kbd>hi</kbd>). The input is shown in the format the input was fed in. <kbd>translatedText</kbd> holds <kbd>Hello</kbd>, which is the exact translation of <em>Namaste</em>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we explored some of the famous and groundbreaking deep learning-based services provided by GCP. We learned how to use Dialogflow using Python to build conversational chatbots that can learn over time. We used the Cloud Vision API to predict the objects recognized in any image. We could easily extrapolate this to a video and achieve similar results. We finally covered the Cloud Translate API for performing deep NLP-based translation using the service. All the major services provided by GCP are accessible over APIs, which makes them easily replaceable in any project. The accuracy of models created by highly trained professionals is commendable and makes the life of a web developer easier when trying to build AI-powered web solutions.</p>
<p>In the next chapter, we will introduce the features offered by <strong>Amazon Web Services</strong> (<strong>AWS</strong>) to integrate AI with web applications using Python.</p>


            </article>

            
        </section>
    </body></html>