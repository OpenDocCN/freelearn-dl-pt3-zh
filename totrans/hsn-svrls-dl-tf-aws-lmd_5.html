<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Creating the Deep Learning API</h1>
                </header>
            
            <article>
                
<p>In the previous chapter we learned about working with TensorFlow on AWS Lambda. This chapter briefs about the RESTful API along with the AWS API Gateway. We will learn how to create the API Gateway using the serverless framework.</p>
<p>In this chapter , we will be covering the following topics:</p>
<ul>
<li>API service</li>
<li>The AWS API Gateway</li>
<li>Creating a deep learning API project</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical Requirements</h1>
                </header>
            
            <article>
                
<p><span>The technical requirements in this chapter are as follows:</span></p>
<ul>
<li>AWS subscription</li>
<li>Python 3.6</li>
<li>AWS CLI</li>
<li>Serverless framework</li>
<li>You can find all the codes at:<span> </span><a href="https://github.com/PacktPublishing/Hands-On-Serverless-Deep-Learning-with-TensorFlow-and-AWS-Lambda">https://github.com/PacktPublishing/Hands-On-Serverless-Deep-Learning-with-TensorFlow-and-AWS-Lambda</a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">RESTful API</h1>
                </header>
            
            <article>
                
<p>The RESTful API has become extremely popular in recent years, with the rising popularity of macro services as a universal way to communicate between different services inside an application—for example, we can use RESTful API services for different programming languages and different hosting platforms together in a single application.</p>
<p>The RESTful API is an interface that allows you to communicate between different applications, and it can serve a lot of purposes. The RESTful API enables you to easily integrate different services. It also allows you to make an easy connection between the frontend and backend of an application, and it allows other developers to use your service. The deep learning API, in this context, allows you to easily integrate deep learning models within your application or provide other developers with a way to use your model. Now let's look at the API Gateway service in more detail.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">AWS API Gateway</h1>
                </header>
            
            <article>
                
<p>The API Gateway is a double service that allows you to create, publish, monitor, and secure APIs. We can connect the API Gateway not only to business Lambda but also to AWS EC2 instances, <strong>Elastic Clusters</strong> (<strong>ECS</strong>), or even to <strong>Elastic Beanstalk</strong> (<strong>EBS</strong>). It has a pay-as-you-go system, which makes it very convenient as a starting service. Let's look at the specific features of the API Gateway.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Features</h1>
                </header>
            
            <article>
                
<p class="mce-root">The following are some of the features of the API Gateway:</p>
<ul>
<li><strong>Easy to scale</strong>: The API service takes care of scaling, which means we do not have to worry as to whether this is a good way to handle peak loads, and whether it will over-provision resources.</li>
<li><strong>Traffic management</strong>: The API Gateway has a way to control the traffic. The main use case in traffic management is throttling when we want to have a more uniform load on the backend. This is not an issue with AWS Lambda, as it can scale almost indefinitely.</li>
<li><strong>Authorization</strong>: This allows you to control user access to the API. This means that we can either keep the API private or commercialize it. This feature is essential for your application.</li>
<li><strong>Monitoring</strong>: This feature enables us to get usage statistics at the user level. This is important if we want to limit users based on their usage, and if we need to troubleshoot our API.</li>
<li><strong>Caching</strong>: This allows you to reduce the amount of requests, which go to the backend by caching some of the responses. If your application has to deal with the load of repetitive requests, then the switch would significantly reduce the amount of usage at the backend.</li>
<li><strong>Version control</strong>: This allows you to manage multiple versions of the API, which is very important for the production of the application.</li>
</ul>
<p>Now, let's look at the pricing of the API.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Pricing</h1>
                </header>
            
            <article>
                
<p>One of the main advantages of the API Gateway is its pay-as-you-go feature. The pricing for the service amounts to 3.5 dollars per million requests and around 0.09 dollars per 1 GB of data transfer charges. Other optional charges may apply to the services that are chosen. Therefore, we need to make sure that it helps to reduce the cost of the backend. The cost we saw for the API Gateway can be extremely affordable for our project. For beginners, the AWS API Gateway is part of the free tier, and you can get 1 million requests per month for free. Kindly note that the free tier is only for new users.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating the API Gateway</h1>
                </header>
            
            <article>
                
<p>Now that we are aware of the costing and features of the API G<span>ateway</span>, we will create the API Gateway using the AWS console. But before we start, we will need to create and locate AWS Lambda (created in <a href="67913362-94d8-4c74-850e-f6b09ca49367.xhtml">Chapter 4</a>, <em>Working with TensorFlow on AWS Lambda</em>), and then we will learn how to create a connection between the AWS API Gateway and AWS Lambda.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an AWS Lambda instance</h1>
                </header>
            
            <article>
                
<p>We will create the AWS Lambda instance and connect to a Gateway using the AWS console. Let's start with creating the AWS Lambda instance and choose the administrative role that we created in the previous chapter, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-705 image-border" src="assets/816e7fcc-b806-4732-b3af-8f46ff04ecf9.png" style="width:67.67em;height:38.58em;"/></p>
<p>Let's test the function and check that it has been created using the <span class="packt_screen">Test</span> option in the top-right side of the screen, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/ee0b5cdb-5c4f-4738-8dbe-0c49b593072a.png"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>Now, let's add the API Gateway trigger by clicking on the <span class="packt_screen">API Gateway</span> option on the left side under <span class="packt_screen">Add triggers</span>. Now under the <span class="packt_screen">Configure triggers</span> tab, select <span class="packt_screen">Create a new API</span> and select an <span class="packt_screen">Open</span> API endpoint. Now, under <span class="packt_screen">Additional setting<strong>,</strong></span> just check the API name and click on <span class="packt_screen">Add</span> to create the API and save it. This will give you the page shown in the following screenshot, which has a link to the API to test on your browser:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8136981c-e426-4441-b0fa-a3e3738f16f8.png"/></p>
<p>As you can see, it produced a result that is similar to the demo code, as seen in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e35d989c-7f0f-4259-9c48-7c69cbbef1ae.png"/></p>
<p>Now we are ready with the AWS Lambda and the API Gateway, we will be creating the connection using the serverless framework.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating the API Gateway using the serverless framework</h1>
                </header>
            
            <article>
                
<p>Before creating the API, let us look at our project files: the main Python file (<kbd>index.py</kbd>) and the serverless configuration file (<kbd>serverless.yml</kbd>). Let's look at the Python file as shown in the following code:</p>
<pre>import json<br/>def handler(event, context):<br/>print('Log event', event)<br/>return{<br/>'status code': 200;<br/>'body': json.dump('Hello world API!')<br/>}</pre>
<p>From the preceding code block, you can see that this file will be returning a JSON response instead of the string to the API request. For this, we need to change <kbd>status code</kbd> to <kbd>200</kbd> and change <kbd>body</kbd> to <kbd>transform</kbd> in the JSON format.</p>
<p>In the server configuration file, we will be adding a <kbd>events</kbd> and adding an API endpoint name:</p>
<pre class="CDPAlignLeft CDPAlign">functions:<br/>  main:<br/>    handler: index.handler<br/>    events:<br/>      - http: GET hello</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deploying the serverless framework</h1>
                </header>
            
            <article>
                
<p>Now let's deploy the service by using the following command:</p>
<pre><strong>serverless deploy</strong></pre>
<p>On successful completion of the deployment, it will return the URL for the API Gateway. Now test the URL we got on the command line using the <kbd>curl</kbd> command and URL:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4e50043f-76b9-4473-923f-9ae5aed4d8f2.png"/></p>
<p>We can also run the URL in the browser and test the deployment to find the desired output.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a first API project</h1>
                </header>
            
            <article>
                
<p>Now let us start by creating the example of the deep learning API project. Before we start the project, let's look at our files: the main Python file and the service configuration file, along with some libraries files and the inception model.</p>
<p>In this project, we will be adding one <kbd>events</kbd> section and the endpoint name. In the Python file, we will be returning a JSON response to a request. Also, we will make Lambda accept the link to the image in the request and then apply it to a module. The we will be deploying the server and testing the files in the command line and browser, as we checked out in the previous section.</p>
<p>The present configuration file is a combination of changes from the previous section and is very much similar. An additional part where are will be making a change is in the Python file, where we have added reading URL parameters. As you can see, if no URL is present, we use our image taken earlier. But, if we have the URL path, we can download the image from the URL.</p>
<p>Now let's deploy the service using the <kbd>serverless deploy</kbd> command, which will provide you with the URL of the API Gateway. Let's test this URL using the <kbd>curl</kbd> command and from the browser and you will find the same response that we had in the previous section:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/43272726-ba2f-4203-9d54-02619f8e20b9.png"/></p>
<p>We can also test the deployment by downloading the image. To test this, we only have to add the URL of the image as a parameter to the API Gateway URL.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we learned about the API Gateway services and the RESTful API. We saw how the AWS Gateway is cost effective for our application. Then we looked at how to create the AWS API Gateway and AWS Lambda using the AWS console. We also created a connection between AWS Lambda and the AWS API Gateway using the serverless framework. Finally, we created the deep learning API project using the API Gateway.</p>
<p>In the next chapter, we will be creating crossing pipelines by connected and obvious Lambda little bills is curious where we will learn how to make a deep learning pipeline.</p>


            </article>

            
        </section>
    </body></html>