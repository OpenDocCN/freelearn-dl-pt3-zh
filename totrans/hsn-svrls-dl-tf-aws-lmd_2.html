<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Starting Deployment with AWS Lambda Functions</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will understand more about AWS Lambda and learn how it works. We will also discuss the different ways of deploying Lambda and the things we need to consider while developing applications for AWS Lambda.</p>
<p>We will learn how to set up an AWS account along with access management. We will also create a Hello World function using AWS Lambda.</p>
<p>We will cover the following topics:</p>
<ul>
<li>AWS Lambda functions</li>
<li>Getting started with AWS account</li>
<li>Introduction to Serverless framework</li>
<li>Deploying AWS Lambda functions</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical Requirements</h1>
                </header>
            
            <article>
                
<p>The technical requirements in this chapter are as follows:</p>
<ul>
<li>AWS subscription</li>
<li>Python 3.6</li>
<li>AWS CLI</li>
<li>Serverless framework</li>
<li>You can find all the codes at<span> </span><a href="https://github.com/PacktPublishing/Hands-On-Serverless-Deep-Learning-with-TensorFlow-and-AWS-Lambda">https://github.com/PacktPublishing/Hands-On-Serverless-Deep-Learning-with-TensorFlow-and-AWS-Lambda</a><a href="https://github.com/PacktPublishing/Hands-On-Serverless-Deep-Learning-with-TensorFlow-and-AWS-Lambda"/></li>
</ul>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">AWS Lambda functions</h1>
                </header>
            
            <article>
                
<p>Let's go through the pre-requisites of <span>AWS Lambda as shown here:</span></p>
<pre>import sys, os<br/>import mylib<br/>...<br/>def handler(event, context):<br/>  ...<br/>  print("Hello world log")<br/>  return result</pre>
<p><span>It consists of the following steps:</span></p>
<ol>
<li>Importing libraries, which you have already installed on AWS Lambda. This includes system libraries and a number of AWS-specific libraries. You don't have to include these libraries within your package.</li>
<li>Importing external libraries, from other developers and companies, or your own libraries. You need to include them in your package.</li>
<li>Implementing <kbd>handler</kbd> function which handles processing of the requests to the main variables as input event and context. The <kbd>event</kbd> is trigger-specific information and <kbd>context</kbd> is information about Lambda, which handles requests. It contains the ID and parameters of the function.</li>
<li>Process the request.</li>
<li>Return the <kbd>result</kbd>, this will either be provided back to the trigger in the event of a synchronous execution or it'll be saved to the log in the event of asynchronous execution.</li>
</ol>
<div class="packt_infobox">You need to keep in mind that you can't use any context or state other than the one which comes from the trigger. Also, if you print something during the code's execution, it will be saved to the local stream of the function.</div>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Pros, cons, and limitations of AWS Lambda</h1>
                </header>
            
            <article>
                
<p>There are certain pros, cons, and limitations of AWS Lambda, as described here:</p>
<ul>
<li><strong>Pros</strong>: AWS Lambda is very easy to deploy. We don't have to know the Docker or other container frameworks to manage it. It should only contain libraries and code. AWS Lambda easily connects to triggers, which means that we can easily integrate it with various other infrastructures and it is very scalable as well, which makes it extremely useful for production deployment. It is relatively inexpensive too.</li>
<li><strong>Cons</strong>: It may be difficult hard to debug in the various Lambdas locally. You have to recreate the entire environment and libraries and also be able to check your memory consumption during timeout. Making good estimations of how fast you will be able to produce high peak loads is quite difficult with AWS Lambda. AWS Lambda is stateless and it greatly effects how you organize your application. This means that the stage should come from the trigger.</li>
<li><strong>Limitations</strong>: There are certain limitations with RAM, disk, CPU, and timeout which you have to consider during development.</li>
</ul>
<p>The following diagram describes the pros, cons, and limitations in detail:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/89425dc0-bb93-4dc3-8bd1-46c757a5a414.png" style="width:38.25em;height:14.25em;"/></div>
<p>Now that we have a fair idea with the pros, cons, and limitations of AWS Lambda, let us have a look at the basics of creating an AWS account.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting started with AWS account</h1>
                </header>
            
            <article>
                
<p>In this section, you will learn about the AWS free tier and the IAM. We need to have an AWS account to learn in depth.</p>
<div class="packt_infobox">If you do not have an AWS account, you can sign up here: <span class="URLPACKT"><a href="https://aws.amazon.com/account/" target="_blank">https://aws.amazon.com/account/</a>.</span></div>
<p>The Lambda API Gateway, the simple queue service, and functions are a part of the AWS Free Tier, so you won't be charged for a small amount of consumption.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">AWS Free Tier</h1>
                </header>
            
            <article>
                
<p>The Free Tier allows you to have free usage of AWS services. It covers a number of different AWS services like:</p>
<ul>
<li><strong>AWS Lambda</strong>: This covers 1 million invocations, which makes a Lambda perfect for hosting your pet project</li>
<li><strong>AWS API Gateway</strong>: This covers 1 million requests through a paid gateway, so it can be extended to work on the project with an AWS REST API functionality</li>
<li><strong>AWS SQS</strong>: This includes 1 million simple queue services and requests</li>
<li><strong>AWS step functions</strong>: This includes 4,000 state transitions of step functions, which will allow us to create free serverless workflows</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Identity and Access Management (IAM)</h1>
                </header>
            
            <article>
                
<p>There are two types of accesses that you can create for an AWS user:</p>
<ul>
<li><strong>AWS management control access</strong>: This allows you to use AWS web services. The user needs to have a login ID and password, which the user will use online.</li>
<li><strong>Programmatic access</strong>: This allows you to use an AWS software development key. The user needs two keys: the access key ID and a secret access key.</li>
</ul>
<p class="mce-root"/>
<p>Now, let's a create a user with programmatic access. It will allow us to use a serverless framework, which will manage the deployment and orchestration of AWS Lambdas.</p>
<p>In order to create the user, we will follow the below steps:</p>
<ol>
<li>First, you need to go to the AWS dashboard and choose the IAM service, as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-727 image-border" src="assets/1eb32034-2c27-49b9-98a4-196e6563abd0.png" style="width:42.42em;height:39.92em;"/></div>
<ol start="2">
<li>Next, go to the <span class="packt_screen">Users</span> page and click on <span class="packt_screen">Add user</span>, as shown here:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f58936ce-a375-486a-b042-51e532a668c7.png"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<ol start="3">
<li>Now, set up the name, <kbd>lambda</kbd>, and select the <span class="packt_screen">Programmatic access</span> checkbox:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/93b701c3-d6d2-472a-9395-86d9ad4b98e3.png"/></p>
<ol start="4">
<li>Next, you will need to set permissions for the user to use the AWS services discussed earlier. The easiest way to do that is by choosing <span class="packt_screen">Attach existing policies directly</span> and then choosing the <span class="packt_screen">AdministratorAccess</span> policy, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/460ef36a-ee11-4c37-bb77-39d9ebc507cd.png"/></div>
<ol start="5">
<li>Finally, you need to confirm all the choices:<img src="assets/eb2655cd-7ce4-4565-a02d-797415f9bd38.png" style="text-align: center;color: #333333;font-size: 1em;"/></li>
</ol>
<ol start="6">
<li>It will show us the access key ID and secret access key. You can either copy them from the web service or save them through the CSV file. You will need these access keys later while setting up the serverless framework, as shown here:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/fc5c5246-c8d6-467d-8cec-8808c0c8139b.png"/></div>
<p>In the next section, we will create a hello word AWS Lambda function.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a Hello World AWS Lambda function</h1>
                </header>
            
            <article>
                
<p>There are three primary ways to create a Hello World an AWS Lambda from the AWS console:</p>
<ul>
<li>We can create a Lambda from scratch. It is the easiest way to create a simple Lambda.</li>
<li>We can use existing blueprint to create a Lambda. AWS has a catalog of usages for any base Lambda, and you can use it to start with a Lambda, which is closer to the project you want to create.</li>
<li>In 2018, AWS added serverless application repositories where users can submit their Lambda configurations. The repository has hundreds of different Lambda packages and it is extremely useful to create a Hello World in AWS Lambda.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the Lambda function</h1>
                </header>
            
            <article>
                
<p>We'll discuss the ways of using the Lambda function with the following points:</p>
<ul>
<li>You can use the inline editor in AWS Service Cloud 9. It can be very helpful in cases where you don't want to install anything locally and want to keep all your files in the cloud. The drawback is that it can be pretty challenging to automate deployment with the inline editor, as well as handling complex side libraries and large projects with multiple files.</li>
<li>You can upload a ZIP file with libraries and code, either through the web interface or through the command line. This is a very straightforward process, which you can easily automate. The main drawback of this approach is that the package has a 50 MB limitation on size.</li>
<li>The best and the most popular way to upload the package is through the S3 bucket. It doesn't have a 50 MB limitation for the package, although, a 250 MB limit for our ZIP libraries and the code will still be in place.</li>
</ul>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">AWS Lambda code</h1>
                </header>
            
            <article>
                
<p>Perform the following steps to create the Hello World code:</p>
<ol>
<li>Log in with your <kbd>lambda</kbd> IAM user. Go to the AWS console and choose the AWS Lambda service:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-725 image-border" src="assets/d83182ce-03c9-40b4-ba95-c239f5a7335c.png" style="width:27.75em;height:14.17em;"/></div>
<ol start="2">
<li>Click on <span class="packt_screen">Create a function<strong>,</strong></span> as shown in the following screenshot:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-738 image-border" src="assets/6b693d6a-b0a6-431d-8c12-6fe1323faacc.png" style="width:52.67em;height:9.25em;"/></div>
<ol start="3">
<li>Choose <span class="packt_screen">Author from scratch<strong>,</strong></span> as shown here:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/c62ae4e1-8bd9-49c1-97b5-a7688b81f0a6.png"/></div>
<ol start="4">
<li>We need to add a <span class="packt_screen">Name</span>, <span class="packt_screen">Runtime</span>, and <span class="packt_screen">Role</span>. Then , we need to add a <span class="packt_screen">Role name</span>, <kbd>helloLambda</kbd>. For <span class="packt_screen">Policy templates</span>, select <span class="packt_screen">Simple microservice permissions</span> and click on the <span class="packt_screen">Create function</span> button, as shown in the following screenshot:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/53c8855b-95a6-48df-8b1d-58cfc8b29da5.png"/></div>
<ol start="5">
<li>Finally, we get the interface of AWS Lambda. We get the connected triggers, code editor, and settings:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/12b77641-6928-43fb-a73e-a47f372db501.png"/></div>
<ol start="6">
<li><span>You need to configure the test event and start your first Lambda function. </span>For our first Lambda function, you can just make an empty event:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/91d23aa8-74a0-467b-9da2-c971c05d50bc.png"/></div>
<ol start="7">
<li>Edit the code and save it and you'll see that a Lambda has been updated:</li>
</ol>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/c655b3f9-67c8-4ad6-9f3a-0d4019478d77.png"/></div>
<div>In the next section, we will learn about the serverless framework.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction to the serverless framework</h1>
                </header>
            
            <article>
                
<p>In the previous sections, we learned about the different ways to deploy the Lambda function.  Although the Lambda package is just ZIP files with libraries and codes, there are ways to deploy them as mentioned below. A production usage deployment needs to have the following features:</p>
<ul>
<li>First of all, the serverless framework should have a single configuration file where we can set all the options and parameters of deployment. This will allow us to save time while writing long scripts for starting each service separately and it will enable us to keep versions of our environment.</li>
<li>It should be able to create and attach other AWS services to add to a Lambda. Since most use cases involve a Lambda working as a part of a bigger infrastructure, deploying other parts of infrastructure separately can be a huge issue.</li>
<li>Having a convenient command-line interface helps a lot because not only would it mean that you can deploy everything using a single script but also set up automatic deployment.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Features of the serverless framework</h1>
                </header>
            
            <article>
                
<p> A serverless framework has a number of useful features. They are as follows:</p>
<ul>
<li>It is open source, which means that the serverless community helps to build and maintain the framework. This allows the framework to be free and up-to-date.</li>
<li>The serverless framework supports different public cloud platforms, such as AWS Google call functions and Azure functions. It means that you don't have to learn how the UI works for either of the mentioned services. You can use the same common UI to deploy functions on another service.</li>
<li>The serverless framework has a production-level quality and a number of companies use it for deploying the serverless infrastructure.</li>
<li>It has a plug-in system, which allows users to create custom plugins for the frameworks. It allows serverless to have various functionality; for example, supporting step functions.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installation of the serverless framework</h1>
                </header>
            
            <article>
                
<p>In order to install the serverless framework, we need to install the following functions:</p>
<ul>
<li>We will need to install Node and NPM (<a href="https://nodejs.org/download/">https://nodejs.org/download/</a>). The serverless framework is written in JavaScript, so it requires Node for execution and NPM for handling the packages.</li>
<li>We will need Python (<a href="https://www.python.org/downloads" target="_blank">https://www.python.org/downloads</a>) and <kbd>pip</kbd> (<a href="https://pip.pypa.io/en/stable/installing/" target="_blank">https://pip.pypa.io/en/stable/installing/</a>) to run Lambda code locally and we will need it in the various command-line interfaces.</li>
<li>We will need the AWS command-line interface (<a href="https://docs.aws.amazon.com/cli/latest/userguide/installing.html" target="_blank">https://docs.aws.amazon.com/cli/latest/userguide/installing.html</a>), for the serverless framework to connect to your AWS account. Then, we can install the serverless framework and everything will be configured.</li>
</ul>
<div class="packt_infobox">The complete installation process of the serverless framework can be found here <span><a href="https://serverless.com/framework/docs/providers/aws/guide/installation" target="_blank">https://serverless.com/framework/docs/providers/aws/guide/installation</a>.</span></div>
<p>Installing the serverless framework is extremely easy. We just need to run the following command: </p>
<pre><strong>npm install -g serverless</strong></pre>
<p>We can check that it works by running the following command:</p>
<pre><strong>serverless --version</strong></pre>
<p>This will return the version of the installed serverless framework.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deploying AWS Lambda functions using the serverless framework</h1>
                </header>
            
            <article>
                
<p>We will start with what the serverless deployment process looks like:</p>
<ul>
<li>We have code and libraries for a Lambda execution. These are the same libraries and code that you would see if you uploaded your package directly as a ZIP. In that sense, it is very easy to start deploying existing Lambdas through the serverless framework.</li>
<li>We have a configuration file, which basically contains all the information about how a Lambda will be deployed.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuration file</h1>
                </header>
            
            <article>
                
<p>The Lambda configuration file consists of the same parameters, which we have discussed in an earlier section (for example, name, runtime, memory, and timeout). There are three primary differences.</p>
<p>You are not only setting up triggers but also setting up services, in which the triggers depend on. You can set up specific roles and access. Some accesses will be automatically set, but some will need to be configured by you. Finally, you can set up additional plugins, which you will use during deployment. We will look at them in more detail when we deploy the step functions.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deployment process</h1>
                </header>
            
            <article>
                
<p>This section covers the process of deployment, which will be generated in the custom cloud formation file based on our configuration file. Cloud formation is an AWS service, which allows us to automatically deploy multiple services. This is extremely convenient for handling the deployment process, but its notation can be pretty difficult to start with. That is why we are using the server's configuration file, which is more readable. Next, the service framework packages libraries and code in a single package and uploads which will then run the AWS cloud formation service for deployment by using the file generated previously.</p>
<p>Now, let's move on to the actual deployment of a Lambda, using the serverless framework, by looking at the available files.</p>
<p>There are two files: <kbd>index.py</kbd> and <kbd>serverless.yml</kbd>. Let's look at <kbd>index.py</kbd>. The following code will print the input event and return the <kbd>Hello World</kbd> message, as shown in the following snippet:</p>
<pre class="packt_figure CDPAlignLeft CDPAlign">def handler(event,context):<br/>    print('Log event',event)<br/>    return 'Hello world'</pre>
<p>The following snippet shows the <kbd>serverless.yml</kbd> file:</p>
<pre class="packt_figure CDPAlignLeft CDPAlign">service: helloworld<br/><br/>frameworkVersion: "&gt;=1.2.0 &lt;2.0.0"<br/><br/>provider:<br/>  name: aws<br/>  region: us-east-1<br/>  runtime: python3.6<br/>  memorySize: 128<br/>  timeout: 10<br/>         <br/><br/>functions:<br/>  main:<br/>    handler: index.handler</pre>
<p>In the <kbd>serverless.yml</kbd> version, there is the name of the function, the available resources, and the region. <kbd>helloworld</kbd> is the name of the service, which we deploy. <kbd>main</kbd> is the name of the function and <kbd>index.handler</kbd> is the name of the <kbd>index.py</kbd> file and the name of the function inside of their file handler.</p>
<p>One service may have different functions and that is why they are separated. Before deploying them, we can run a Lambda locally. This is one of the good features of the serverless framework, but it may not work with complex libraries because of the differences in OS. We can see that we printed an empty log and received the <kbd>Hello World</kbd> message as output:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img src="assets/6080dc31-5638-4379-9394-eca81fb8a424.png"/></div>
<div class="packt_infobox">Before deploying Lambda, you need to link your AWS account to serverless using following command:<br/>
<kbd>serverless config credentials --provider aws --key "Your access key" --secret "Your secret access key"</kbd></div>
<p class="mce-root"/>
<p><span>You will deploy a Lambda using the serverless framework. </span>Also, even if you have a simple program, it may take some time for the serverless framework to deploy the service:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-726 image-border" src="assets/6003887b-a1e6-46bb-b171-acf88bb82651.png" style="width:85.25em;height:39.33em;"/></div>
<p>Now, you can run the Lambda code and check the output:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fa97a611-bcea-457d-9e08-d4978e1228c9.png"/></p>
<p>As you can see, it is the same as the one we received earlier. There are two great flags, which really helps when working with a Lambda. The first flag helps to send custom events inside a Lambda, thereby, emulating triggers from the custom service and the log allows you to see the log of the current execution. This flag log will allow us to look at the log, and the data flag will allow us to send a custom message.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we learned about AWS Lambda functions, along with getting started with AWS account. We also learned about creating a Hello World AWS Lambda function, along with an introduction to the serverless framework and deployment of AWS Lambda functions.</p>
<p>In the next chapter, we will start deploying TensorFlow models, where we will learn more about TensorFlow models and how to deploy them.</p>


            </article>

            
        </section>
    </body></html>